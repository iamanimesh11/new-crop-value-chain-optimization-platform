//document.getElementById('searchButton').addEventListener('click', function() {
//    // Replace this line with logic to fetch the selected item's image source
//    var selectedItemImage = 'static/images/selectedItem.png';
//
//    // Update the coverImage source with the selected item's image
//    document.getElementById('coverImage').src = selectedItemImage;
//});

     const jsonData = {
    "element_content": "\nAjwan\nAlasande Gram\nAlmond(Badam)\nAlsandikai\nAmaranthus\nAmbada Seed\nAmla(Nelli Kai)\nAmphophalus\nAntawala\nAnthorium\nApple\nApricot(Jardalu/Khumani)\nArecanut(Betelnut/Supari)\nArhar (Tur/Red Gram)(Whole)\nArhar Dal(Tur Dal)\nAshgourd\nAstera\nAvare Dal\nBajra(Pearl Millet/Cumbu)\nBalekai\nBamboo\nBanana\nBanana - Green\nBarley (Jau)\nBay leaf (Tejpatta)\nBeans\nBeaten Rice\nBeetroot\nBengal Gram Dal (Chana Dal)\nBengal Gram(Gram)(Whole)\nBer(Zizyphus/Borehannu)\nBetal Leaves\nBetelnuts\nBhindi(Ladies Finger)\nBig Gram\nBinoula\nBitter gourd\nBlack Gram (Urd Beans)(Whole)\nBlack Gram Dal (Urd Dal)\nBlack pepper\nBOP\nBorehannu\nBottle gourd\nBran\nBrinjal\nBroken Rice\nBroomstick(Flower Broom)\nBull\nBullar\nBunch Beans\nButter\nCabbage\nCalf\nCamel Hair\nCane\nCapsicum\nCardamoms\nCarnation\nCarrot\nCashew Kernnel\nCashewnuts\nCastor Oil\nCastor Seed\nCauliflower\nChakotha\nChapparad Avare\nChennangi (Whole)\nChennangi Dal\nCherry\nChikoos(Sapota)\nChili Red\nChilly Capsicum\nChow Chow\nChrysanthemum\nChrysanthemum(Loose)\nCinamon(Dalchini)\nCloves\nCluster beans\nCoca\nCock\nCocoa\nCoconut\nCoconut Oil\nCoconut Seed\nCoffee\nColacasia\nCopra\nCoriander(Leaves)\nCorriander seed\nCotton\nCotton Seed\nCow\nCowpea (Lobia/Karamani)\nCowpea(Veg)\nCucumbar(Kheera)\nCummin Seed(Jeera)\nCustard Apple (Sharifa)\nDaila(Chandni)\nDal (Avare)\nDalda\nDelha\nDhaincha\nDrumstick\nDry Chillies\nDry Fodder\nDry Grapes\nDuck\nDuster Beans\nEgg\nEgypian Clover(Barseem)\nElephant Yam (Suran)\nField Pea\nFig(Anjura/Anjeer)\nFirewood\nFish\nFlower Broom\nFoxtail Millet(Navane)\nFrench Beans (Frasbean)\nGalgal(Lemon)\nGarlic\nGhee\nGingelly Oil\nGinger(Dry)\nGinger(Green)\nGladiolus Bulb\nGladiolus Cut Flower\nGoat\nGoat Hair\nGram Raw(Chholia)\nGramflour\nGrapes\nGreen Avare (W)\nGreen Chilli\nGreen Fodder\nGreen Gram (Moong)(Whole)\nGreen Gram Dal (Moong Dal)\nGreen Peas\nGround Nut Oil\nGround Nut Seed\nGroundnut\nGroundnut (Split)\nGroundnut pods (raw)\nGuar\nGuar Seed(Cluster Beans Seed)\nGuava\nGur(Jaggery)\nGurellu\nHaralekai\nHe Buffalo\nHen\nHippe Seed\nHoney\nHonge seed\nHybrid Cumbu\nIndian Beans (Seam)\nIndian Colza(Sarson)\nIsabgul (Psyllium)\nJack Fruit\nJaffri\nJaggery\nJamamkhan\nJamun(Narale Hannu)\nJarbara\nJasmine\nJavi\nJowar(Sorghum)\nJute\nJute Seed\nKabuli Chana(Chickpeas-White)\nKacholam\nKakada\nKankambra\nKaramani\nKarbuja(Musk Melon)\nKartali (Kantola)\nKharif Mash\nKhoya\nKinnow\nKnool Khol\nKodo Millet(Varagu)\nKuchur\nKulthi(Horse Gram)\nLadies Finger\nLak(Teora)\nLeafy Vegetable\nLemon\nLentil (Masur)(Whole)\nLilly\nLime\nLinseed\nLint\nLitchi\nLittle gourd (Kundru)\nLong Melon(Kakri)\nLotus\nLotus Sticks\nLukad\nMace\nMahedi\nMahua\nMahua Seed(Hippe seed)\nMaida Atta\nMaize\nMango\nMango (Raw-Ripe)\nMaragensu\nMarasebu\nMarget\nMarigold(Calcutta)\nMarigold(loose)\nMash\nMashrooms\nMasur Dal\nMataki\nMethi Seeds\nMethi(Leaves)\nMillets\nMint(Pudina)\nMoath Dal\nMoath Dal\nMousambi(Sweet Lime)\nMustard\nMustard Oil\nMyrobolan(Harad)\nNargasi\nNearle Hannu\nNeem Seed\nNelli Kai\nNiger Seed (Ramtil)\nNutmeg\nOnion\nOnion Green\nOrange\nOrchid\nOther Pulses\nOx\nPaddy(Dhan)(Basmati)\nPaddy(Dhan)(Common)\nPapaya\nPapaya (Raw)\nPatti Calcutta\nPeach\nPear(Marasebu)\nPeas cod\nPeas Wet\nPeas(Dry)\nPegeon Pea (Arhar Fali)\nPepper garbled\nPepper ungarbled\nPersimon(Japani Fal)\nPigs\nPineapple\nPlum\nPointed gourd (Parval)\nPolherb\nPomegranate\nPotato\nPumpkin\nPundi\nPundi Seed\nRaddish\nRagi (Finger Millet)\nRaibel\nRajgir\nRam\nRat Tail Radish (Mogari)\nRaya\nRed Gram\nResinwood\nRiccbcan\nRice\nRidgeguard(Tori)\nRose(Local)\nRose(Loose))\nRose(Tata)\nRound gourd\nRubber\nSabu Dan\nSafflower\nSaffron\nSajje\nSame/Savi\nSarasum\nSeason Leaves\nSeegu\nSeemebadnekai\nSeetapal\nSesamum(Sesame,Gingelly,Til)\nShe Buffalo\nShe Goat\nSheep\nSiddota\nSkin And Hide\nSnakeguard\nSoanf\nSoapnut(Antawala/Retha)\nSoji\nSompu\nSoyabean\nSpinach\nSponge gourd\nSquash(Chappal Kadoo)\nSugar\nSugarcane\nSunflower\nSunflower Seed\nSunhemp\nSuram\nSurat Beans (Papadi)\nSuva (Dill Seed)\nSuvarna Gadde\nSweet Potato\nSweet Pumpkin\nT.V. Cumbu\nTamarind Fruit\nTamarind Seed\nTapioca\nTaramira\nTea\nTender Coconut\nThinai (Italian Millet)\nThogrikai\nThondekai\nTinda\nTobacco\nTomato\nTorchwood\nToria\nTube Flower\nTube Rose(Double)\nTube Rose(Loose)\nTube Rose(Single)\nTurmeric\nTurmeric (raw)\nTurnip\nWalnut\nWater Melon\nWheat\nWheat Atta\nWhite Peas\nWhite Pumpkin\nWood\nWool\nYam\nYam (Ratalu)\n"
};

// Function to populate dropdown options and initialize Select2
// Function to populate dropdown options
function populateDropdown(dropdown, items) {
  // Clear existing options
  dropdown.innerHTML = "";
  // Add the default placeholder option
        var placeholderOption = document.createElement('option');
        placeholderOption.value = '';
        placeholderOption.disabled = true;
        placeholderOption.selected = true;
        placeholderOption.textContent = '--Select Item--';
        dropdown.appendChild(placeholderOption);
  // Populate options from the array
  items.forEach(item => {
    const option = document.createElement('option');
    option.value = item;
    option.textContent = item;
    dropdown.appendChild(option);
  });
}


document.addEventListener('DOMContentLoaded', function() {
    // Your JavaScript code here
    generateFarmerCards();
    populateDropdown(document.getElementById('itemDropdown'), jsonData.element_content.trim().split('\n'));
});




   var farmerData = [
        {
            crop: 'Wheat',
            quantity: '10 kg',
            price: 'Rs 50/kg',
            date: '2023-11-28',
            profilePic: 'static/images/account-icon-23.png',
            name:'hhgg',

            phone: '+91 9876543210',
            email: 'farmer1@example.com'
        },
        {
            crop: 'Rice',
            quantity: '80 kg',
            price: 'Rs 60/kg',
            date: '2023-11-29',
            profilePic: 'static/images/account-icon-23.png',
            name:'hhgg',
            phone: '+91 9876543220',
            email: 'farmer2@example.com'
        },
        {
            crop: 'Rice',
            quantity: '80 kg',
            price: 'Rs 60/kg',
            date: '2023-11-29',
            profilePic: 'static/images/account-icon-23.png',
            name:'hhgg',
            phone: '+91 9876543220',
            email: 'farmer2@example.com'
        },

        // Add more farmer data as needed
    ];

     var currentPage = 1;
    var cardsPerPage = 4;

// Function to dynamically generate and display farmer cards
    function generateFarmerCards() {




    var container = document.querySelector('.farmer-cards-container');

    if (!container) {
        console.error('Container not found');
        return;
    }
         // Calculate start and end indices based on current page and cards per page
      var startIndex = (currentPage - 1) * cardsPerPage;
      var endIndex = startIndex + cardsPerPage;

      var currentData = farmerData.slice(startIndex, endIndex);
      container.innerHTML = '';

        currentData.forEach(function (farmer) {
            var card = document.createElement('div');
            card.className = 'farmer-card';

            var profileSection = document.createElement('div');
            profileSection.className = 'profile-section';

            var cropDetails = document.createElement('div');
            cropDetails.className = 'crop-details';

            var h3 = document.createElement('h3');
            h3.textContent = 'Commodity: ' + farmer.crop;

            var sendMessageButton = document.createElement('button');
            sendMessageButton.innerHTML = '<i class="fas fa-paper-plane"></i> Send Message';
            sendMessageButton.onclick = function () {
                $('#messagingModal').modal('show');

                sendMessage(farmer.name); // Pass the farmer's name to the sendMessage function
            };
            sendMessageButton.classList.add('sendMessageButton');


            var addToCartButton = document.createElement('button');
            addToCartButton.innerHTML = '<i class="fas fa-cart-plus"></i>';
            addToCartButton.onclick = function () {

                    $('#addtocartModal').modal('show');
                      addToCartFromCard(addToCartButton);

                        addToCartButton.classList.add('clicked');
            };

            document.getElementById('addtocartmodalclose').onclick = function () {
            // Hide the confirmation modal
            $('#addtocartModal').modal('hide');
          };
            addToCartButton.classList.add('addToCartButton');

            var quantityP = document.createElement('p');
            quantityP.textContent = 'Quantity: ' + farmer.quantity;

            var priceP = document.createElement('p');
            priceP.textContent = 'Price: ' + farmer.price;

            var dateP = document.createElement('p');
            dateP.textContent = 'Date: ' + farmer.date;

            cropDetails.appendChild(h3);
            cropDetails.appendChild(quantityP);
            cropDetails.appendChild(priceP);
            cropDetails.appendChild(dateP);
            cropDetails.appendChild(sendMessageButton);

            var profilePic = document.createElement('img');
            profilePic.className = 'profile-pic';
            profilePic.src = farmer.profilePic;
            profilePic.alt = 'Profile Picture';

            profileSection.appendChild(profilePic);

            profileSection.appendChild(cropDetails);

            var contactDetails = document.createElement('div');
            contactDetails.className = 'contact-details';

            var h4 = document.createElement('h4');
            h4.textContent = 'Contact Details';

            var nameP = document.createElement('p');
            nameP.innerHTML = '<i class="fas fa-user contact-icons"></i> ' +  farmer.name;

            var phoneP = document.createElement('p');
            phoneP.innerHTML = '<i class="fas fa-phone contact-icons"></i>' + farmer.phone;

            var emailP = document.createElement('p');
            emailP.innerHTML = '<i class="fas fa-envelope contact-icons"></i> ' + farmer.email;

            var favoriteIcon = document.createElement('i');
            favoriteIcon.className = 'favorite-icon fas fa-heart';
            favoriteIcon.onclick = function () {
                toggleFavorite(favoriteIcon);
            };

            contactDetails.appendChild(h4);
            contactDetails.appendChild(nameP);

            contactDetails.appendChild(phoneP);
            contactDetails.appendChild(emailP);
            contactDetails.appendChild(favoriteIcon);


            card.appendChild(profileSection);
             card.appendChild(addToCartButton);

            card.appendChild(contactDetails);

            container.appendChild(card);
        });

             document.getElementById('currentPage').textContent = 'Page ' + currentPage;
             // Update the search results title
        var searchResultsTitle = document.getElementById("searchResultsTitle");
        searchResultsTitle.textContent = `Showing  ${farmerData.length} results `;
     }
function updatePagination() {
  var totalPages = Math.ceil(farmerData.length / cardsPerPage);
  var prevButton = document.querySelector('.pagination-container button:first-child');
  var nextButton = document.querySelector('.pagination-container button:last-child');
  var currentPageSpan = document.getElementById('currentPage');
  var totalPagesSpan = document.getElementById('totalPages');

  // Check if elements are found before accessing properties
  if (prevButton && nextButton && currentPageSpan && totalPagesSpan) {
    prevButton.disabled = currentPage === 1;
    nextButton.disabled = currentPage === totalPages;

    // Update the displayed current page number
    currentPageSpan.textContent = 'Page ' + currentPage;

    // Update the total pages
    totalPagesSpan.textContent = totalPages;
  }
}

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        generateFarmerCards();
        updatePagination();
      }
    }

    function nextPage() {
      var totalPages = Math.ceil(farmerData.length / cardsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        generateFarmerCards();
        updatePagination();
      }
    }

    // Call generateFarmerCards initially to display the first page
    generateFarmerCards();
    updatePagination();

document.addEventListener('DOMContentLoaded', function () {
  // Function to add card content to the cart modal
  window.addToCartFromCard = function(button) {
    const cardBody = button.closest('.farmer-card');

    // Check if cardBody is found
    if (cardBody) {
      const cardContent = cardBody.cloneNode(true);

      const buyNowButton = document.createElement('button');
      buyNowButton.textContent = 'Buy Now';
      buyNowButton.onclick = function () {
        handleBuyNow(cardBody);
      };

      addCartItem(cardContent);
      cardContent.appendChild(buyNowButton);

    } else {
      console.error('Error: closest .card-body not found.');
    }
  };

    // Function to add item to the cart modal
    function addCartItem(itemContent) {
      const cartItemList = document.getElementById('cartItemList');
      const cartTotalElement = document.getElementById('cartTotal');

      // Calculate total price
      let totalPrice = parseInt(cartTotalElement.textContent.replace('Rs ', '')) || 0;

      // Create a new list item for the cart
      const listItem = document.createElement('li');
      listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
      listItem.appendChild(itemContent);

      // Extract the price from the card content and update the total price
      const priceMatch = itemContent.textContent.match(/Rs (\d+)/);
      if (priceMatch) {
        const itemPrice = parseInt(priceMatch[1]);
        totalPrice += itemPrice;
      }

      // Update total price
      cartTotalElement.textContent = `Rs ${totalPrice}`;

      // Add the new item to the cart
      cartItemList.appendChild(listItem);

      // Show the cart modal
    }
  });

   // Function to send a message
   $(document).ready(function() {
    // Function to handle form submission
    $("#message-form").submit(function(e) {
      e.preventDefault(); // Prevents the default form submission

      // Get the message from the input
      var message = $("#message-input").val();

      // Check if the message is not empty
      if (message.trim() !== "") {
        // Append the message to the chat container
        var chatMessages = document.getElementById("chat-messages");
        chatMessages.innerHTML += `<p><strong>You:</strong> ${message}</p>`;

        // Clear the input field
        $("#message-input").val("");

        // Scroll to the bottom of the chat container
        $("#chat-messages").scrollTop($("#chat-messages")[0].scrollHeight);
      }
    });
  });

  document.getElementById('totalPages').textContent = Math.ceil(farmerData.length / cardsPerPage);

    var mediaRecorder;
    var audioChunks = [];

    function startRecording() {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function (stream) {
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = function (event) {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                mediaRecorder.onstop = function () {
                    var audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    var audioUrl = URL.createObjectURL(audioBlob);
                    appendAudioMessage('user', audioUrl);
                    audioChunks = [];
                };
                mediaRecorder.start();
            })
            .catch(function (err) {
                console.error('Error accessing microphone:', err);
            });
    }

    function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
        }
    }

    function appendAudioMessage(sender, audioUrl) {
        var chatBody = document.getElementById('chatBody');
        var audioMessage = document.createElement('audio');
        audioMessage.className = 'message ' + sender + '-message';
        audioMessage.controls = true;
        audioMessage.src = audioUrl;
        chatBody.insertBefore(audioMessage, chatBody.firstChild);
    }
        document.getElementById('userInput').addEventListener('input', function () {
            var userInput = document.getElementById('userInput').value;
            var sendButton = document.getElementById('sendButton');
            if (userInput === "") {
                sendButton.classList.remove('en-button');
                sendButton.classList.add('mic-button');
        document.getElementById('sendIcon').innerHTML = '<i class="fas fa-microphone"></i>';
            } else {
                sendButton.classList.remove('mic-button');
                sendButton.classList.add('en-button');
                document.getElementById('sendIcon').innerHTML = '<i class="fas fa-paper-plane"></i>';
            }
        });

        document.getElementById('userInput').addEventListener('keydown', function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById('sendButton').click();
            }
        });

        function appendMessage(sender, message) {
            var chatBody = document.getElementById('chatBody');
            var messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + sender + '-message';
            messageDiv.innerText = message;
            chatBody.insertBefore(messageDiv, chatBody.firstChild);

        }


        document.getElementById('sendButton').addEventListener('click', function (event) {
            event.preventDefault();
            var userInput = document.getElementById('userInput').value;
                        document.getElementById('userInput').value="";
            if (sendButton.classList.contains('mic-button')) {
                    // If the mic button is clicked, start recording
// If the mic button is clicked, show recording view
        showRecordingView();

        // Simulate a delay (e.g., 3 seconds) for recording
        setTimeout(function () {
            hideRecordingView();
            // Add any additional functionality related to stopping recording
            startRecording();
        }, 3000);                }
            else{
            if (userInput.trim() !== "") {
                appendMessage('user', userInput);
                // Update the send button icon to microphone
                     document.getElementById('sendButton').classList.remove('en-button');
                    document.getElementById('sendButton').classList.add('mic-button');
                    document.getElementById('sendIcon').innerHTML = '<i class="fas fa-microphone"></i>';

                var botResponse = sendMessageToBot(userInput);
                appendMessage('bot', botResponse);

            } else {
                var errorMessage = document.createElement('div');
                errorMessage.className = 'message error-message';
                errorMessage.innerText = 'Please write a message before sending.';
                var chatBody = document.getElementById('chatBody');
                chatBody.insertBefore(errorMessage, chatBody.firstChild);
                setTimeout(function () {
                    errorMessage.remove();
                }, 1500);
            }
                        }

        });

 // Function to simulate recording view
function showRecordingView() {
    var chatBody = document.getElementById('chatBody');
    var recordingMessage = document.createElement('div');
    recordingMessage.className = 'message recording-message';
    recordingMessage.innerText = 'Recording...';
    chatBody.insertBefore(recordingMessage, chatBody.firstChild);
}

// Function to simulate stopping recording view
function hideRecordingView() {
    var recordingMessage = document.querySelector('.recording-message');
    if (recordingMessage) {
        recordingMessage.remove();
    }
}

     // Function to append a welcome message from the bot on page load
        function appendWelcomeMessage() {
            var chatBody = document.getElementById('chatBody');
            var welcomeMessage = document.createElement('div');
            welcomeMessage.className = 'message bot-message';
            welcomeMessage.innerText = 'Hello!  I help you today?';
            chatBody.appendChild(welcomeMessage);
                    speak(welcomeMessage.innerText);

        }

        // Function to use the Web Speech API to speak a given text
        function speak(text) {
            var synth = window.speechSynthesis;
            var utterance = new SpeechSynthesisUtterance(text);
            synth.speak(utterance);
        }

        // Append the welcome message when the page loads
        window.addEventListener('load', function () {
            appendWelcomeMessage();
        });

      // Function to toggle the chatbot popup visibility
        function toggleChatbotPopup() {
            var popup = document.getElementById('chatbotPopup');
            popup.style.display = (popup.style.display === 'none' || popup.style.display === '') ? 'block' : 'none';
        }

        // Function to close the chatbot popup
        function closeChatbotPopup() {
            var popup = document.getElementById('chatbotPopup');
            popup.style.display = 'none';
        }

        // Attach click event to the chatbot button
        document.getElementById('chatbotButton').addEventListener('click', function () {
            toggleChatbotPopup();
        });
