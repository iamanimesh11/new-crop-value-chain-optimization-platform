// Add this script to the end of your existing JavaScript

   const jsonData = {
    "element_content": "\n--Select Item--\nAjwan\nAlasande Gram\nAlmond(Badam)\nAlsandikai\nAmaranthus\nAmbada Seed\nAmla(Nelli Kai)\nAmphophalus\nAntawala\nAnthorium\nApple\nApricot(Jardalu/Khumani)\nArecanut(Betelnut/Supari)\nArhar (Tur/Red Gram)(Whole)\nArhar Dal(Tur Dal)\nAshgourd\nAstera\nAvare Dal\nBajra(Pearl Millet/Cumbu)\nBalekai\nBamboo\nBanana\nBanana - Green\nBarley (Jau)\nBay leaf (Tejpatta)\nBeans\nBeaten Rice\nBeetroot\nBengal Gram Dal (Chana Dal)\nBengal Gram(Gram)(Whole)\nBer(Zizyphus/Borehannu)\nBetal Leaves\nBetelnuts\nBhindi(Ladies Finger)\nBig Gram\nBinoula\nBitter gourd\nBlack Gram (Urd Beans)(Whole)\nBlack Gram Dal (Urd Dal)\nBlack pepper\nBOP\nBorehannu\nBottle gourd\nBran\nBrinjal\nBroken Rice\nBroomstick(Flower Broom)\nBull\nBullar\nBunch Beans\nButter\nCabbage\nCalf\nCamel Hair\nCane\nCapsicum\nCardamoms\nCarnation\nCarrot\nCashew Kernnel\nCashewnuts\nCastor Oil\nCastor Seed\nCauliflower\nChakotha\nChapparad Avare\nChennangi (Whole)\nChennangi Dal\nCherry\nChikoos(Sapota)\nChili Red\nChilly Capsicum\nChow Chow\nChrysanthemum\nChrysanthemum(Loose)\nCinamon(Dalchini)\nCloves\nCluster beans\nCoca\nCock\nCocoa\nCoconut\nCoconut Oil\nCoconut Seed\nCoffee\nColacasia\nCopra\nCoriander(Leaves)\nCorriander seed\nCotton\nCotton Seed\nCow\nCowpea (Lobia/Karamani)\nCowpea(Veg)\nCucumbar(Kheera)\nCummin Seed(Jeera)\nCustard Apple (Sharifa)\nDaila(Chandni)\nDal (Avare)\nDalda\nDelha\nDhaincha\nDrumstick\nDry Chillies\nDry Fodder\nDry Grapes\nDuck\nDuster Beans\nEgg\nEgypian Clover(Barseem)\nElephant Yam (Suran)\nField Pea\nFig(Anjura/Anjeer)\nFirewood\nFish\nFlower Broom\nFoxtail Millet(Navane)\nFrench Beans (Frasbean)\nGalgal(Lemon)\nGarlic\nGhee\nGingelly Oil\nGinger(Dry)\nGinger(Green)\nGladiolus Bulb\nGladiolus Cut Flower\nGoat\nGoat Hair\nGram Raw(Chholia)\nGramflour\nGrapes\nGreen Avare (W)\nGreen Chilli\nGreen Fodder\nGreen Gram (Moong)(Whole)\nGreen Gram Dal (Moong Dal)\nGreen Peas\nGround Nut Oil\nGround Nut Seed\nGroundnut\nGroundnut (Split)\nGroundnut pods (raw)\nGuar\nGuar Seed(Cluster Beans Seed)\nGuava\nGur(Jaggery)\nGurellu\nHaralekai\nHe Buffalo\nHen\nHippe Seed\nHoney\nHonge seed\nHybrid Cumbu\nIndian Beans (Seam)\nIndian Colza(Sarson)\nIsabgul (Psyllium)\nJack Fruit\nJaffri\nJaggery\nJamamkhan\nJamun(Narale Hannu)\nJarbara\nJasmine\nJavi\nJowar(Sorghum)\nJute\nJute Seed\nKabuli Chana(Chickpeas-White)\nKacholam\nKakada\nKankambra\nKaramani\nKarbuja(Musk Melon)\nKartali (Kantola)\nKharif Mash\nKhoya\nKinnow\nKnool Khol\nKodo Millet(Varagu)\nKuchur\nKulthi(Horse Gram)\nLadies Finger\nLak(Teora)\nLeafy Vegetable\nLemon\nLentil (Masur)(Whole)\nLilly\nLime\nLinseed\nLint\nLitchi\nLittle gourd (Kundru)\nLong Melon(Kakri)\nLotus\nLotus Sticks\nLukad\nMace\nMahedi\nMahua\nMahua Seed(Hippe seed)\nMaida Atta\nMaize\nMango\nMango (Raw-Ripe)\nMaragensu\nMarasebu\nMarget\nMarigold(Calcutta)\nMarigold(loose)\nMash\nMashrooms\nMasur Dal\nMataki\nMethi Seeds\nMethi(Leaves)\nMillets\nMint(Pudina)\nMoath Dal\nMoath Dal\nMousambi(Sweet Lime)\nMustard\nMustard Oil\nMyrobolan(Harad)\nNargasi\nNearle Hannu\nNeem Seed\nNelli Kai\nNiger Seed (Ramtil)\nNutmeg\nOnion\nOnion Green\nOrange\nOrchid\nOther Pulses\nOx\nPaddy(Dhan)(Basmati)\nPaddy(Dhan)(Common)\nPapaya\nPapaya (Raw)\nPatti Calcutta\nPeach\nPear(Marasebu)\nPeas cod\nPeas Wet\nPeas(Dry)\nPegeon Pea (Arhar Fali)\nPepper garbled\nPepper ungarbled\nPersimon(Japani Fal)\nPigs\nPineapple\nPlum\nPointed gourd (Parval)\nPolherb\nPomegranate\nPotato\nPumpkin\nPundi\nPundi Seed\nRaddish\nRagi (Finger Millet)\nRaibel\nRajgir\nRam\nRat Tail Radish (Mogari)\nRaya\nRed Gram\nResinwood\nRiccbcan\nRice\nRidgeguard(Tori)\nRose(Local)\nRose(Loose))\nRose(Tata)\nRound gourd\nRubber\nSabu Dan\nSafflower\nSaffron\nSajje\nSame/Savi\nSarasum\nSeason Leaves\nSeegu\nSeemebadnekai\nSeetapal\nSesamum(Sesame,Gingelly,Til)\nShe Buffalo\nShe Goat\nSheep\nSiddota\nSkin And Hide\nSnakeguard\nSoanf\nSoapnut(Antawala/Retha)\nSoji\nSompu\nSoyabean\nSpinach\nSponge gourd\nSquash(Chappal Kadoo)\nSugar\nSugarcane\nSunflower\nSunflower Seed\nSunhemp\nSuram\nSurat Beans (Papadi)\nSuva (Dill Seed)\nSuvarna Gadde\nSweet Potato\nSweet Pumpkin\nT.V. Cumbu\nTamarind Fruit\nTamarind Seed\nTapioca\nTaramira\nTea\nTender Coconut\nThinai (Italian Millet)\nThogrikai\nThondekai\nTinda\nTobacco\nTomato\nTorchwood\nToria\nTube Flower\nTube Rose(Double)\nTube Rose(Loose)\nTube Rose(Single)\nTurmeric\nTurmeric (raw)\nTurnip\nWalnut\nWater Melon\nWheat\nWheat Atta\nWhite Peas\nWhite Pumpkin\nWood\nWool\nYam\nYam (Ratalu)\n"
};

// Function to populate dropdown options and initialize Select2
// Function to populate dropdown options and initialize Select2
function populateDropdown() {
  const itemNameDropdown = document.getElementById('itemName');

  // Clear existing options
  itemNameDropdown.innerHTML = "";

  // Split the string into an array of items
  const items = jsonData.element_content.trim().split('\n');

  // Populate options from the array
  items.forEach(item => {
    const option = document.createElement('option');
    option.value = item;
    option.textContent = item;
    itemNameDropdown.appendChild(option);
  });

}

// Function to handle checkbox click event
function handleOtherCheckbox() {
  const otherCheckbox = document.getElementById('otherCheckbox');
  const otherItemInput = document.getElementById('otherItemInput');
    const itemNameDropdown = document.getElementById('itemName');
    const itemlabel = document.getElementById('itemlabel');

  itemNameDropdown.style.display = otherCheckbox.checked ? 'none' : 'block';
  itemlabel.style.display = otherCheckbox.checked ? 'none' : 'block';
  // Show/hide the input field based on checkbox state
  otherItemInput.style.display = otherCheckbox.checked ? 'block' : 'none';
}

$(document).ready(function () {
  $('#addItemModal').modal({
    backdrop: 'static', // Prevents modal from closing when clicking outside
    keyboard: false // Prevents modal from closing with the keyboard (e.g., Esc key)
  });
});
function openAddItemModal() {
    // Show the Add Item Modal
    $('#addItemModal').modal('show');

        populateDropdown();

 // Set up event listener for checkbox click
  const otherCheckbox = document.getElementById('otherCheckbox');
  otherCheckbox.addEventListener('click', handleOtherCheckbox);

    handleOtherCheckbox();
 // Event listener for the close button in the modal header
  document.getElementById('closeModalButton').addEventListener('click', function () {
      document.getElementById('errorMessage').textContent = '';

    $('#addItemModal').modal('hide');
    document.getElementById('itemForm').reset();
  });

   // Event listener for the close button in the modal header
  document.getElementById('crossModalButton').addEventListener('click', function () {
    document.getElementById('errorMessage').textContent = '';
    $('#addItemModal').modal('hide');
    document.getElementById('itemForm').reset();
     });
   }


  function submitItemForm() {
  // Get values from the form
  const itemNameDropdown = document.getElementById('itemName');
  const otherCheckbox = document.getElementById('otherCheckbox');
  const otherItemInput = document.getElementById('otherInput');
  const itemName = otherCheckbox.checked ? otherItemInput.value : itemNameDropdown.value;
  const rawItemQuantity = document.getElementById('itemQuantity').value;
  const rawItemPrice = document.getElementById('itemtPrice').value;
  const quantityUnit = document.getElementById('quantityUnit').value;



   const errorMessageElement = document.getElementById('errorMessage');
   // Validate and add the item to the inventory table
  if (itemName==="--Select Item--") {
    // Display error message
    errorMessageElement.textContent = 'Please Select Item';
    return;
  }

  errorMessageElement.textContent = '';

  // Validate and add the item to the inventory table
  if (!itemName || !rawItemQuantity || !rawItemPrice) {
    // Display error message
    errorMessageElement.textContent = 'Please fill in all fields before adding an item.';
    return;
  }
    if (rawItemQuantity <1||rawItemPrice <1) {
        // Display error message
        errorMessageElement.textContent = 'Quantity & price must be greater than 1';
        return;
      }
  errorMessageElement.textContent = '';
 // Parse quantity and price after checking other conditions
  const itemQuantity = parseInt(rawItemQuantity, 10);
  const itemtPrice = parseInt(rawItemPrice, 10);

  // Validate and add the item to the inventory table
  if (itemName && itemQuantity && itemtPrice) {
    // Create a new table row
    const newRow = document.createElement('tr');

    const itemPrice = itemtPrice/itemQuantity;
    // Create table cells for each column
    const nameCell = document.createElement('td');
    nameCell.textContent = itemName;

    const quantityCell = document.createElement('td');
    quantityCell.textContent = itemQuantity + ' ' + quantityUnit; ;

    const priceCell = document.createElement('td');
    priceCell.textContent = '₹ '+ itemPrice + '/' + quantityUnit;

    const tpriceCell = document.createElement('td');
    tpriceCell.textContent = '₹ '+ itemtPrice;

// Add "Edit" button before other buttons
    const editButtonCell = document.createElement('td');
    const editButton = document.createElement('button');
    editButton.textContent = 'Edit';
    editButton.classList.add('btn', 'btn-info', 'btn-sm');
    editButton.onclick = function () {
      editItem(item.id);
    };


    // Add a delete button for the new row
    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete';
    deleteButton.classList.add('btn', 'btn-danger','delete' ,'btn-sm');
    deleteButton.onclick = function () {
      // Set the item name in the modal
  document.getElementById('deleteConfirmationItemName').textContent = itemName;

  document.getElementById('confirmDeleteButton').onclick = function () {
    // Handle delete action (remove the row)
    newRow.remove();

    $('#deleteConfirmationModal').modal('hide');
  };

document.getElementById('deltemodalclose').onclick = function () {
    $('#deleteConfirmationModal').modal('hide');
  };

  // Show the confirmation modal
  $('#deleteConfirmationModal').modal('show');
};
    editButtonCell.appendChild(editButton);
    editButtonCell.appendChild(deleteButton);


    newRow.appendChild(nameCell);
    newRow.appendChild(quantityCell);
    newRow.appendChild(priceCell);

    newRow.appendChild(tpriceCell);
    newRow.appendChild(editButtonCell);

    // Append the new row to the table body
    document.getElementById('inventoryTableBody').appendChild(newRow);

    // Hide the form after submission
    $('#addItemModal').modal('hide');
    document.getElementById('itemForm').reset();
  }
}

// Function to render inventory table
function renderInventory() {
  const tableBody = document.getElementById('inventoryTableBody');
  tableBody.innerHTML = '';

  inventory.forEach(item => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${item.name}</td>
      <td>${item.quantity}</td>
      <td>
        <button class="btn btn-info btn-sm" onclick="editItem(${item.id})">Edit</button>
        <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id})">Delete</button>
      </td>
    `;
    tableBody.appendChild(row);
  });
}

// Function to add a new item
function addItem() {
  const itemNameDropdown = document.getElementById('itemName');
  const otherCheckbox = document.getElementById('otherCheckbox');
  const otherItemInput = document.getElementById('otherInput');

  // If "Other" checkbox is checked, use the input field value; otherwise, use the dropdown value
  const itemName = otherCheckbox.checked ? otherItemInput.value : itemNameDropdown.value;

  if (itemName) {
    const newItem = { id: inventory.length + 1, name: itemName, quantity: 0 };
    inventory.push(newItem);
    renderInventory();
  }
}

// Function to edit an existing item
function editItem(itemId) {
  const item = inventory.find(item => item.id === itemId);
  const newQuantity = prompt(`Enter new quantity for ${item.name}:`, item.quantity);
  if (newQuantity !== null && !isNaN(newQuantity)) {
    item.quantity = parseInt(newQuantity, 10);
    renderInventory();
  }
}

// Function to delete an item
function deleteItem(itemId) {
  const confirmDelete = confirm('Are you sure you want to delete this item?');
  if (confirmDelete) {
    inventory = inventory.filter(item => item.id !== itemId);
    renderInventory();
  }
}

// Initial render
renderInventory();



  // Item picture (replace 'item-image-placeholder.jpg' with your actual image path)
  const itemImage = document.createElement('img');
  itemImage.classList.add('card-img-top');

 // Set the src attribute dynamically based on the item name and supported extensions
  const supportedExtensions = ['jpg', 'jpeg', 'JPEG','png', 'gif', 'bmp']; // List of supported image extensions
  const imagePath = findImage(itemName, supportedExtensions); // Custom function to find the correct image


  itemImage.src = imagePath;
  itemImage.alt = 'Item Image';


  // Function to find the correct image based on supported extensions
function findImage(itemName, supportedExtensions) {
  for (const ext of supportedExtensions) {
    const imagePath = `static/images/cropimage/${encodeURIComponent(itemName)}.${ext}`;
    // Check if the image exists
    const img = new Image();
    img.src = imagePath;
    if (img.complete) {
      return imagePath;
    }
  }

  // If no image is found, return a default image path
  return 'static/images/logo.png'; // Update to your default image path
}