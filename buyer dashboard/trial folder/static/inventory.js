// Add this script to the end of your existing JavaScript

   const jsonData = {
    "element_content": "\n--Select Item--\nAjwan\nAlasande Gram\nAlmond(Badam)\nAlsandikai\nAmaranthus\nAmbada Seed\nAmla(Nelli Kai)\nAmphophalus\nAntawala\nAnthorium\nApple\nApricot(Jardalu/Khumani)\nArecanut(Betelnut/Supari)\nArhar (Tur/Red Gram)(Whole)\nArhar Dal(Tur Dal)\nAshgourd\nAstera\nAvare Dal\nBajra(Pearl Millet/Cumbu)\nBalekai\nBamboo\nBanana\nBanana - Green\nBarley (Jau)\nBay leaf (Tejpatta)\nBeans\nBeaten Rice\nBeetroot\nBengal Gram Dal (Chana Dal)\nBengal Gram(Gram)(Whole)\nBer(Zizyphus/Borehannu)\nBetal Leaves\nBetelnuts\nBhindi(Ladies Finger)\nBig Gram\nBinoula\nBitter gourd\nBlack Gram (Urd Beans)(Whole)\nBlack Gram Dal (Urd Dal)\nBlack pepper\nBOP\nBorehannu\nBottle gourd\nBran\nBrinjal\nBroken Rice\nBroomstick(Flower Broom)\nBull\nBullar\nBunch Beans\nButter\nCabbage\nCalf\nCamel Hair\nCane\nCapsicum\nCardamoms\nCarnation\nCarrot\nCashew Kernnel\nCashewnuts\nCastor Oil\nCastor Seed\nCauliflower\nChakotha\nChapparad Avare\nChennangi (Whole)\nChennangi Dal\nCherry\nChikoos(Sapota)\nChili Red\nChilly Capsicum\nChow Chow\nChrysanthemum\nChrysanthemum(Loose)\nCinamon(Dalchini)\nCloves\nCluster beans\nCoca\nCock\nCocoa\nCoconut\nCoconut Oil\nCoconut Seed\nCoffee\nColacasia\nCopra\nCoriander(Leaves)\nCorriander seed\nCotton\nCotton Seed\nCow\nCowpea (Lobia/Karamani)\nCowpea(Veg)\nCucumbar(Kheera)\nCummin Seed(Jeera)\nCustard Apple (Sharifa)\nDaila(Chandni)\nDal (Avare)\nDalda\nDelha\nDhaincha\nDrumstick\nDry Chillies\nDry Fodder\nDry Grapes\nDuck\nDuster Beans\nEgg\nEgypian Clover(Barseem)\nElephant Yam (Suran)\nField Pea\nFig(Anjura/Anjeer)\nFirewood\nFish\nFlower Broom\nFoxtail Millet(Navane)\nFrench Beans (Frasbean)\nGalgal(Lemon)\nGarlic\nGhee\nGingelly Oil\nGinger(Dry)\nGinger(Green)\nGladiolus Bulb\nGladiolus Cut Flower\nGoat\nGoat Hair\nGram Raw(Chholia)\nGramflour\nGrapes\nGreen Avare (W)\nGreen Chilli\nGreen Fodder\nGreen Gram (Moong)(Whole)\nGreen Gram Dal (Moong Dal)\nGreen Peas\nGround Nut Oil\nGround Nut Seed\nGroundnut\nGroundnut (Split)\nGroundnut pods (raw)\nGuar\nGuar Seed(Cluster Beans Seed)\nGuava\nGur(Jaggery)\nGurellu\nHaralekai\nHe Buffalo\nHen\nHippe Seed\nHoney\nHonge seed\nHybrid Cumbu\nIndian Beans (Seam)\nIndian Colza(Sarson)\nIsabgul (Psyllium)\nJack Fruit\nJaffri\nJaggery\nJamamkhan\nJamun(Narale Hannu)\nJarbara\nJasmine\nJavi\nJowar(Sorghum)\nJute\nJute Seed\nKabuli Chana(Chickpeas-White)\nKacholam\nKakada\nKankambra\nKaramani\nKarbuja(Musk Melon)\nKartali (Kantola)\nKharif Mash\nKhoya\nKinnow\nKnool Khol\nKodo Millet(Varagu)\nKuchur\nKulthi(Horse Gram)\nLadies Finger\nLak(Teora)\nLeafy Vegetable\nLemon\nLentil (Masur)(Whole)\nLilly\nLime\nLinseed\nLint\nLitchi\nLittle gourd (Kundru)\nLong Melon(Kakri)\nLotus\nLotus Sticks\nLukad\nMace\nMahedi\nMahua\nMahua Seed(Hippe seed)\nMaida Atta\nMaize\nMango\nMango (Raw-Ripe)\nMaragensu\nMarasebu\nMarget\nMarigold(Calcutta)\nMarigold(loose)\nMash\nMashrooms\nMasur Dal\nMataki\nMethi Seeds\nMethi(Leaves)\nMillets\nMint(Pudina)\nMoath Dal\nMoath Dal\nMousambi(Sweet Lime)\nMustard\nMustard Oil\nMyrobolan(Harad)\nNargasi\nNearle Hannu\nNeem Seed\nNelli Kai\nNiger Seed (Ramtil)\nNutmeg\nOnion\nOnion Green\nOrange\nOrchid\nOther Pulses\nOx\nPaddy(Dhan)(Basmati)\nPaddy(Dhan)(Common)\nPapaya\nPapaya (Raw)\nPatti Calcutta\nPeach\nPear(Marasebu)\nPeas cod\nPeas Wet\nPeas(Dry)\nPegeon Pea (Arhar Fali)\nPepper garbled\nPepper ungarbled\nPersimon(Japani Fal)\nPigs\nPineapple\nPlum\nPointed gourd (Parval)\nPolherb\nPomegranate\nPotato\nPumpkin\nPundi\nPundi Seed\nRaddish\nRagi (Finger Millet)\nRaibel\nRajgir\nRam\nRat Tail Radish (Mogari)\nRaya\nRed Gram\nResinwood\nRiccbcan\nRice\nRidgeguard(Tori)\nRose(Local)\nRose(Loose))\nRose(Tata)\nRound gourd\nRubber\nSabu Dan\nSafflower\nSaffron\nSajje\nSame/Savi\nSarasum\nSeason Leaves\nSeegu\nSeemebadnekai\nSeetapal\nSesamum(Sesame,Gingelly,Til)\nShe Buffalo\nShe Goat\nSheep\nSiddota\nSkin And Hide\nSnakeguard\nSoanf\nSoapnut(Antawala/Retha)\nSoji\nSompu\nSoyabean\nSpinach\nSponge gourd\nSquash(Chappal Kadoo)\nSugar\nSugarcane\nSunflower\nSunflower Seed\nSunhemp\nSuram\nSurat Beans (Papadi)\nSuva (Dill Seed)\nSuvarna Gadde\nSweet Potato\nSweet Pumpkin\nT.V. Cumbu\nTamarind Fruit\nTamarind Seed\nTapioca\nTaramira\nTea\nTender Coconut\nThinai (Italian Millet)\nThogrikai\nThondekai\nTinda\nTobacco\nTomato\nTorchwood\nToria\nTube Flower\nTube Rose(Double)\nTube Rose(Loose)\nTube Rose(Single)\nTurmeric\nTurmeric (raw)\nTurnip\nWalnut\nWater Melon\nWheat\nWheat Atta\nWhite Peas\nWhite Pumpkin\nWood\nWool\nYam\nYam (Ratalu)\n"
};

// Function to populate dropdown options and initialize Select2
// Function to populate dropdown options
function populateDropdown(dropdown, items) {
  // Clear existing options
  dropdown.innerHTML = "";

  // Populate options from the array
  items.forEach(item => {
    const option = document.createElement('option');
    option.value = item;
    option.textContent = item;
    dropdown.appendChild(option);
  });
}


// Usage

// Function to handle checkbox click event
function handleOtherCheckbox() {
  const otherCheckbox = document.getElementById('otherCheckbox');
  const otherItemInput = document.getElementById('otherItemInput');
    const itemNameDropdown = document.getElementById('itemName');
    const itemlabel = document.getElementById('itemlabel');

  itemNameDropdown.style.display = otherCheckbox.checked ? 'none' : 'block';
  itemlabel.style.display = otherCheckbox.checked ? 'none' : 'block';
  // Show/hide the input field based on checkbox state
  otherItemInput.style.display = otherCheckbox.checked ? 'block' : 'none';
}
function edithandleOtherCheckbox() {
  const otherCheckbox = document.getElementById('editotherCheckbox');
  const otherItemInput = document.getElementById('editotherItemInput');
    const itemNameDropdown = document.getElementById('edititemName');
    const itemlabel = document.getElementById('edititemlabel');

  itemNameDropdown.style.display = otherCheckbox.checked ? 'none' : 'block';
  itemlabel.style.display = otherCheckbox.checked ? 'none' : 'block';
  // Show/hide the input field based on checkbox state
  otherItemInput.style.display = otherCheckbox.checked ? 'block' : 'none';
}

$(document).ready(function () {
  $('#addItemModal').modal({
    backdrop: 'static', // Prevents modal from closing when clicking outside
    keyboard: false // Prevents modal from closing with the keyboard (e.g., Esc key)
  });
});
function openAddItemModal() {
    // Show the Add Item Modal
    $('#addItemModal').modal('show');

populateDropdown(document.getElementById('itemName'), jsonData.element_content.trim().split('\n'));
populateDropdown(document.getElementById('edititemName'), jsonData.element_content.trim().split('\n'));

 // Set up event listener for checkbox click
  const otherCheckbox = document.getElementById('otherCheckbox');
  otherCheckbox.addEventListener('click', handleOtherCheckbox);

    handleOtherCheckbox();
 // Event listener for the close button in the modal header
  document.getElementById('closeModalButton').addEventListener('click', function () {
      document.getElementById('errorMessage').textContent = '';

    $('#addItemModal').modal('hide');
    document.getElementById('itemForm').reset();
  });

   // Event listener for the close button in the modal header
  document.getElementById('crossModalButton').addEventListener('click', function () {
    document.getElementById('errorMessage').textContent = '';
    $('#addItemModal').modal('hide');
    document.getElementById('itemForm').reset();
     });


   }

// Function to handle form submission
function submitItemForm() {

  const itemNameDropdown = document.getElementById('itemName');
  const otherCheckbox = document.getElementById('otherCheckbox');
  const otherItemInput = document.getElementById('otherInput');
  const itemName = otherCheckbox.checked ? otherItemInput.value : itemNameDropdown.value;
  const rawItemQuantity = document.getElementById('itemQuantity').value;
  const rawItemPrice = document.getElementById('itemtPrice').value;

   const errorMessageElement = document.getElementById('errorMessage');

  // Validate and add the item to the inventory table
  const validationError = validateForm(itemName, rawItemQuantity, rawItemPrice);
  if (validationError) {
    errorMessageElement.textContent = validationError;
    return;
  }

  const itemQuantity = parseInt(rawItemQuantity, 10);
  const itemtPrice = parseInt(rawItemPrice, 10);
  const quantityUnit = document.getElementById('quantityUnit').value;

  const existingRow = findExistingRow(itemName);

if (existingRow) {
  document.getElementById('updateConfirmationItemName').textContent = itemName;

  document.getElementById('confirmUpdateButton').onclick = function () {
    updateExistingRow(existingRow, itemQuantity, itemtPrice, quantityUnit);
    $('#updateConfirmationModal').modal('hide');
  };
  document.getElementById('updateCancelModalButton').onclick = function () {
    $('#updateConfirmationModal').modal('hide');
  };
  $('#updateConfirmationModal').modal('show');
} else {
  createNewRow(itemName, itemQuantity, itemtPrice, quantityUnit);
}
  $('#addItemModal').modal('hide');
  document.getElementById('itemForm').reset();

    updateCardView();

}

// Function to validate form inputs
function validateForm(itemName, rawItemQuantity, rawItemPrice) {
  if (itemName === "--Select Item--") {
    return 'Please Select Item';
  }
  if (!itemName || !rawItemQuantity || !rawItemPrice) {
    return 'Please fill in all fields before adding an item.';
  }
  const itemQuantity = parseInt(rawItemQuantity, 10);
  const itemtPrice = parseInt(rawItemPrice, 10);
  if (itemQuantity < 1 || itemtPrice < 1) {
    return 'Quantity & price must be greater than 1';
  }
  return null; // No validation error
}

// Function to find an existing row based on item name
function findExistingRow(itemName) {
  const tableBody = document.getElementById('inventoryTableBody');
  const rows = tableBody.getElementsByTagName('tr');


  for (let i = 0; i < rows.length; i++) {
    const nameCell = rows[i].cells[0];
    if (nameCell && nameCell.textContent === itemName) {
      return rows[i];
    }
  }

  return null; // Return null if no existing row is found
}

// Function to update an existing row with new values
function updateExistingRow(existingRow, itemQuantity, itemtPrice, quantityUnit) {
  existingRow.cells[1].textContent = itemQuantity + ' ' + quantityUnit;
  existingRow.cells[2].textContent = '₹ ' + Math.round(itemtPrice / itemQuantity) + '/' + quantityUnit;
  existingRow.cells[3].textContent = '₹ ' + itemtPrice;
}

// Function to create a new table row for the item
function createNewRow(itemName, itemQuantity, itemtPrice, quantityUnit) {
  const newRow = document.createElement('tr');

  const nameCell = document.createElement('td');
  nameCell.textContent = itemName;

  const quantityCell = document.createElement('td');
  quantityCell.textContent = itemQuantity + ' ' + quantityUnit;

  const priceCell = document.createElement('td');
priceCell.textContent = '₹ ' + Math.round(itemtPrice / itemQuantity) + '/' + quantityUnit;

  const tpriceCell = document.createElement('td');
  tpriceCell.textContent = '₹ ' + itemtPrice;

  // Add "Edit" button before other buttons
  const editButtonCell = document.createElement('td');
  const editButton = createEditButton(newRow);
  editButtonCell.appendChild(editButton);

  // Add a delete button for the new row
  const deleteButton = document.createElement('button');
  deleteButton.textContent = 'Delete';
  deleteButton.classList.add('btn', 'btn-danger', 'delete', 'btn-sm');
  deleteButton.onclick = function () {
    handleDelete(newRow);
  };

  // ... (append other buttons if needed)
  editButtonCell.appendChild(deleteButton);

  // Append cells to the new row
  newRow.appendChild(nameCell);
  newRow.appendChild(quantityCell);
  newRow.appendChild(priceCell);
  newRow.appendChild(tpriceCell);
  newRow.appendChild(editButtonCell);

  // Append the new row to the table body
  document.getElementById('inventoryTableBody').appendChild(newRow);
}


// Function to create an "Edit" button for a row
function createEditButton(row) {
  const editButton = document.createElement('button');
  editButton.textContent = 'Edit';
  editButton.classList.add('btn', 'btn-info', 'btn-sm');
  editButton.onclick = function () {
    editItem(row);
  };
  return editButton;
}

// Function to edit an existing row
function editItem(row) {
  // Populate the form with the values from the selected row
  const itemName = row.cells[0].textContent;
  const quantityValue = row.cells[1].textContent.split(' ')[0]; // Extract the quantity value
  const quantityUnit = row.cells[1].textContent.split(' ')[1]; // Extract the quantity unit
  const totalPrice = row.cells[3].textContent.split(' ')[1]; // Extract the total price

  // Populate the form fields
  document.getElementById('edititemName').value = itemName;
  document.getElementById('edititemQuantity').value = quantityValue;
  document.getElementById('editquantityUnit').value = quantityUnit;
  document.getElementById('edititemtPrice').value = totalPrice;

  // Show the Add Item Modal
  $('#editItemModal').modal('show');

 // Check if the item name exists in the item name dropdown
const itemNameDropdown = document.getElementById('edititemName');
const isOtherItem = !Array.from(itemNameDropdown.options).some(option => option.value === itemName);

// Populate the form fields based on item type
if (isOtherItem) {
  // If it's an "Other" item, populate the "Other" input field
  document.getElementById('editotherItemInput').style.display = 'block';
  document.getElementById('editotherCheckbox').checked = true;
  document.getElementById('editotherInput').value = itemName;
  document.getElementById('editotherInput').disabled = true;
  document.getElementById('editotherCheckbox').disabled = true;

  // Disable item name dropdown and label
  document.getElementById('edititemName').style.display = 'none';
  document.getElementById('edititemlabel').style.display = 'none';
} else {
  // If it's a regular item, populate the item name dropdown
  document.getElementById('edititemName').value = itemName;
  document.getElementById('edititemName').disabled = true;
  document.getElementById('editotherCheckbox').disabled = true;

  // Enable item name dropdown and label
  document.getElementById('edititemName').style.display = 'block';
  document.getElementById('edititemlabel').style.display = 'block';

  // Hide "Other" input field and uncheck the checkbox
  document.getElementById('editotherItemInput').style.display = 'none';
  document.getElementById('editotherCheckbox').checked = false;
}
  // Set up event listener for form submission
  document.getElementById('edititemModalButton').onclick = function () {
    submitEditedItem(row);
  };


  // Set up event listener for checkbox click
  const otherCheckbox = document.getElementById('editotherCheckbox');
  otherCheckbox.addEventListener('click', edithandleOtherCheckbox);

  // Event listener for the close button in the modal header
  document.getElementById('editcloseModalButton').addEventListener('click', function () {
    document.getElementById('editerrorMessage').textContent = '';
    $('#editItemModal').modal('hide');
    document.getElementById('edititemForm').reset();
  });
 }

// Function to submit edited item form
function submitEditedItem(row) {
  const otherCheckbox = document.getElementById('editotherCheckbox');
  const otherItemInput = document.getElementById('editotherInput');
  const rawItemQuantity = document.getElementById('edititemQuantity').value;
  const rawItemPrice = document.getElementById('edititemtPrice').value;

  const errorMessageElement = document.getElementById('editerrorMessage');


  // Validate and update the item in the inventory table
  const validationError = validateForm(itemName, rawItemQuantity, rawItemPrice);
  if (validationError) {
    errorMessageElement.textContent = validationError;
    return;
  }

  const itemQuantity = parseInt(rawItemQuantity, 10);
  const itemtPrice = parseInt(rawItemPrice, 10);
  const quantityUnit = document.getElementById('editquantityUnit').value;

  // Update the existing row with the new values
  updateExistingRow(row, itemQuantity, itemtPrice, quantityUnit);

  // Hide the form after submission
  $('#editItemModal').modal('hide');
  document.getElementById('itemForm').reset();

  updateCardView();
}

// Function to handle delete button click
function handleDelete(row) {
  // Set the item name in the modal
  document.getElementById('deleteConfirmationItemName').textContent = row.cells[0].textContent;

  // Set up event listener for confirm delete button
  document.getElementById('confirmDeleteButton').onclick = function () {
    // Handle delete action (remove the row)
    row.remove();
    updateCardView();

    // Hide the confirmation modal
    $('#deleteConfirmationModal').modal('hide');
  };
  // Set up event listener for close button in the confirmation modal
  document.getElementById('deltemodalclose').onclick = function () {
    // Hide the confirmation modal
    $('#deleteConfirmationModal').modal('hide');
  };

  // Show the confirmation modal
  $('#deleteConfirmationModal').modal('show');

}

// Add this function to your existing script
function createCard(itemName, itemQuantity, itemtPrice, totalItemPrice,unit) {
  const cardContainer = document.getElementById('cardContainer');

  // Create card element
  const card = document.createElement('div');

card.classList.add('col-md-6', 'col-lg-3', 'col-sm-6', 'mb-4'); // Adjust the classes
  card.classList.add('inventory-card');

  // Card body
  const cardBody = document.createElement('div');
  cardBody.classList.add('card', 'shadow', 'h-100');

  // Item picture (replace 'item-image-placeholder.jpg' with your actual image path)
  const itemImage = document.createElement('img');
  itemImage.classList.add('card-img-top');

 // Set the src attribute dynamically based on the item name and supported extensions
  const supportedExtensions = ['jpeg','png']; // List of supported image extensions
  const imagePath = findImage(itemName, supportedExtensions, (path) => {
  itemImage.src = path;
    });

itemImage.alt = 'Item Image';
  console.log(imagePath);
itemImage.style.objectFit = 'cover'; // Set object-fit property

itemImage.style.height = '200px'; // Adjust the height to your desired value

  // Card content
  const cardContent = document.createElement('div');
  cardContent.classList.add('card-body', 'd-flex', 'flex-column');

  // Item name
  const itemNameElement = document.createElement('h5');
  itemNameElement.classList.add('card-title');
  itemNameElement.textContent = itemName;

  // Quantity, Price, and Total Price
  const quantityElement = document.createElement('p');
  quantityElement.classList.add('card-text','quantity-text');
  quantityElement.textContent = `Quantity: ${itemQuantity} ${unit}`;

  const priceElement = document.createElement('p');
  priceElement.classList.add('card-text','price-text');
  priceElement.textContent = `Price: ₹ ${Math.round(totalItemPrice / itemQuantity)} per ${unit}`;

  const totalPriceElement = document.createElement('p');
  totalPriceElement.classList.add('card-text','total-price-text');
  totalPriceElement.textContent = `Total Price: ₹ ${totalItemPrice}`;

  // Actions (Edit and Delete buttons)
  const actionsDiv = document.createElement('div');
  actionsDiv.classList.add('mt-auto');

  const editButton = document.createElement('button');
  editButton.classList.add('btn', 'btn-info', 'btn-sm', 'mr-2', 'edit-card-button');
  editButton.textContent = 'Edit';

   const deleteButton = document.createElement('button');
  deleteButton.classList.add('btn', 'btn-danger', 'btn-sm', 'delete-card-button');
  deleteButton.textContent = 'Delete';

  // Append elements to the card
  cardContent.appendChild(itemNameElement);
  cardContent.appendChild(quantityElement);
  cardContent.appendChild(priceElement);
  cardContent.appendChild(totalPriceElement);
  actionsDiv.appendChild(editButton);
  actionsDiv.appendChild(deleteButton);
  cardContent.appendChild(actionsDiv);

  cardBody.appendChild(itemImage);
  cardBody.appendChild(cardContent);
  card.appendChild(cardBody);

  // Append the card to the container
  cardContainer.appendChild(card);

}
function updateCardView() {
  const cardContainer = document.getElementById('cardContainer');
  cardContainer.innerHTML = ''; // Clear existing cards

  // Loop through each row in the table and create a corresponding card
  const tableRows = document.getElementById('inventoryTableBody').getElementsByTagName('tr');
  for (let i = 0; i < tableRows.length; i++) {
    const cells = tableRows[i].cells;

    const itemName = cells[0].textContent;
    const quantityAndUnit = cells[1].textContent.split(' ');
    const itemQuantity = parseInt(quantityAndUnit[0], 10);

    // Extracting unit price and total price
    const unitAndQuantity = cells[2].textContent.split('/');
    const unitPrice = parseFloat(unitAndQuantity[0].replace('₹ ', '').trim());
    const totalItemPrice = parseFloat(cells[3].textContent.replace('₹ ', ''));
 // Extracting unit from a specific cell (modify this line according to your HTML structure)
    const unitSelect = document.getElementById('quantityUnit');
    const unit = unitSelect.options[unitSelect.selectedIndex].value;

    createCard(itemName, itemQuantity, unitPrice, totalItemPrice,unit);
  }

  // Add event listeners for card actions (edit and delete)
  const editButtons = document.querySelectorAll('.edit-card-button');
  const deleteButtons = document.querySelectorAll('.delete-card-button');

  editButtons.forEach((editButton, index) => {
    editButton.addEventListener('click', function () {
      // Trigger the same action as clicking the corresponding row's edit button
      editItem(tableRows[index]);
    });
  });

  deleteButtons.forEach((deleteButton, index) => {
    deleteButton.addEventListener('click', function () {
      // Trigger the same action as clicking the corresponding row's delete button
      handleDelete(tableRows[index]);
    });
  });
}
  // Function to find the correct image based on supported extensions
function findImage(itemName, supportedExtensions, callback) {
  const checkImage = (extIndex) => {
    if (extIndex >= supportedExtensions.length) {
      // If no image is found, return a default image path
      callback('static/images/logo.png'); // Update to your default image path
      return;
    }

    const ext = supportedExtensions[extIndex];
    const imagePath = `static/images/cropimage/${encodeURIComponent(itemName)}.${ext}`;

    // Check if the image exists
    const img = new Image();
    img.onload = () => {
      // Image found
      callback(imagePath);
    };
    img.onerror = () => {
      // Image not found, try the next extension
      checkImage(extIndex + 1);
    };
    img.src = imagePath;
  };

  // Start checking with the first extension
  checkImage(0);
}